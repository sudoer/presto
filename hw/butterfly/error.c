////////////////////////////////////////////////////////////////////////////////
//   C O M M E N T A R Y
////////////////////////////////////////////////////////////////////////////////

// If you've gotten here, you're in trouble.  These functions report an error
// condition.  The functions are application-specific, since different boards
// will have different ways of reporting stuff to the user.

////////////////////////////////////////////////////////////////////////////////
//   D E P E N D E N C I E S
////////////////////////////////////////////////////////////////////////////////

#include "types.h"
#include "error.h"
#include "cpu_locks.h"
#include "registers.h"
#include "lcd_driver.h"
#include <avr/io.h>


////////////////////////////////////////////////////////////////////////////////
//   S T A T I C   F U N C T I O N S
////////////////////////////////////////////////////////////////////////////////


////////////////////////////////////////////////////////////////////////////////
//   E X T E R N A L   F U N C T I O N S
////////////////////////////////////////////////////////////////////////////////

void error_fatal(error_number_e err) {
   char digit;
   cpu_lock();  // no more interrupts
   lcd_text_digit(0,'E');
   lcd_text_digit(1,'R');
   lcd_text_digit(2,'R');
   digit=(err&0x0F00)>>8;
   lcd_text_digit(3,(digit<10)?(digit+'0'):(digit-10+'A'));
   digit=(err&0x00F0)>>4;
   lcd_text_digit(4,(digit<10)?(digit+'0'):(digit-10+'A'));
   digit=(err&0x000F);
   lcd_text_digit(5,(digit<10)?(digit+'0'):(digit-10+'A'));

   volatile BYTE x=0;
   while (1) {
      while(++x) ;
      //sbi(PINB,5);   // toggle PORTB.5
   }
}

////////////////////////////////////////////////////////////////////////////////

void error_crash(void) {
   // This will cause an ILLEGAL OPERATION interrupt
   /* asm("test"); */
}

////////////////////////////////////////////////////////////////////////////////

void error_address(unsigned short address) {
   cpu_lock();  // no more interrupts
   while (1) {

   }
}

////////////////////////////////////////////////////////////////////////////////





