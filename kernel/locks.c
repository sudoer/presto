
#include "locks.h"

////////////////////////////////////////////////////////////////////////////////

inline unsigned short presto_lock(void) {
  unsigned short mask;
  asm volatile ("tpa\n\tsei" : "=d"(mask));
  return mask;
}

////////////////////////////////////////////////////////////////////////////////

inline void presto_unlock_all(void) {
  asm volatile ("cli");
}

////////////////////////////////////////////////////////////////////////////////

inline void presto_restore_lock(unsigned short mask) {
  asm volatile ("tap" : : "d"(mask));
}

////////////////////////////////////////////////////////////////////////////////

inline void presto_interruption_point (void) {
  asm volatile ("cli\n\tnop\n\tsei");
}

////////////////////////////////////////////////////////////////////////////////

