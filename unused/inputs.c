////////////////////////////////////////////////////////////////////////////////
//   C O M M E N T A R Y
////////////////////////////////////////////////////////////////////////////////


////////////////////////////////////////////////////////////////////////////////
//   D E P E N D E N C I E S
////////////////////////////////////////////////////////////////////////////////

#include "cpu/hc11regs.h"
#include "types.h"
#include "services\inputs.h"
#include "services\serial.h"

////////////////////////////////////////////////////////////////////////////////
//   S P E C I A L   C O M P I L E R   D I R E C T I V E S
////////////////////////////////////////////////////////////////////////////////


////////////////////////////////////////////////////////////////////////////////
//   C O N S T A N T S
////////////////////////////////////////////////////////////////////////////////

#define DIGITAL_IN   (*(unsigned char *)(0x7FFF))


////////////////////////////////////////////////////////////////////////////////
//   D A T A   T Y P E S
////////////////////////////////////////////////////////////////////////////////


////////////////////////////////////////////////////////////////////////////////
//   S T A T I C   G L O B A L   D A T A
////////////////////////////////////////////////////////////////////////////////


////////////////////////////////////////////////////////////////////////////////
//   S T A T I C   F U N C T I O N   P R O T O T Y P E S
////////////////////////////////////////////////////////////////////////////////


////////////////////////////////////////////////////////////////////////////////
//   E X P O R T E D   F U N C T I O N S
////////////////////////////////////////////////////////////////////////////////

uint8 input_sample_analog(uint8 aport) {
   uint8 value;
   INTR_OFF();
   ADCTL=(aport&0x07);
   while((ADCTL&ADCTL_CCF)==0);  // do nothing
   INTR_ON();
   value=ADR1;
   return value;
}

////////////////////////////////////////////////////////////////////////////////

BOOLEAN input_sample_digital(uint8 dport) {
   BOOLEAN value;
   char num[3];
   serial_send_string("[");
   string_IntegerToString(dport,num,2);
   serial_send_string(num);
   serial_send_string(",");
   if(dport>9) return FALSE;
   switch(dport) {
      case 7: {
         value=((PORTA&0x01)==0);
         serial_send_string("A");
      } break;
      case 8: {
        value=((PORTA&0x02)==0);
         serial_send_string("B");
      } break;
      case 9: {
         value=((PORTA&0x80)==0);
         serial_send_string("C");
      } break;
      default: {
         value=((DIGITAL_IN&(1<<dport))==0);
         serial_send_string("D");
      } break;
   }
   serial_send_string(",");
   string_IntegerToString(value,num,1);
   serial_send_string(num);
   serial_send_string("]\r\n");
   return value;
}

////////////////////////////////////////////////////////////////////////////////

BOOLEAN input_stop_button(void) {
    return((DIGITAL_IN&0x40)==0);
}

////////////////////////////////////////////////////////////////////////////////

BOOLEAN input_start_button(void) {
    return((DIGITAL_IN&0x80)==0);
}

////////////////////////////////////////////////////////////////////////////////
//   S T A T I C   F U N C T I O N S
////////////////////////////////////////////////////////////////////////////////

////////////////////////////////////////////////////////////////////////////////

