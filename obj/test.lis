                         .area data
 0000                 _one_tid::
 0000                   .blkb 1
                         .area idata
 0000 00                .byte 0
                         .area data
 0001                 _two_tid::
 0001                   .blkb 1
                         .area idata
 0001 00                .byte 0
                         .area data
 0002                 _three_tid::
 0002                   .blkb 1
                         .area idata
 0002 00                .byte 0
                         .area data
 0003                 _four_tid::
 0003                   .blkb 1
                         .area idata
 0003 00                .byte 0
                         .area data
 0004                 _light1::
 0004                   .blkb 1
                         .area idata
 0004 00                .byte 0
                         .area data
 0005                 _light2::
 0005                   .blkb 1
                         .area idata
 0005 00                .byte 0
                         .area data
 0006                 _light3::
 0006                   .blkb 1
                         .area idata
 0006 00                .byte 0
                         .area data
 0007                 _light4::
 0007                   .blkb 1
                         .area idata
 0007 00                .byte 0
                         .area text
                       ;  IX -> 0,x
                       ;  rMEM -> 2,x
                       ;         lights -> 5,x
 0000                 _assert_lights::
 0000 BD0000            jsr __enterb
 0003 06                .byte 0x6
 0004                 test.40::	
                       ; 
                       ; #include "presto.h"
                       ; #include "types.h"
                       ; //#include "services.h"
                       ; //#include "priority.h"
                       ; 
                       ; ////////////////////////////////////////////////////////////////////////////////
                       ; 
                       ; // system crashes after 21 seconds (42*500=21000,35*600=21000,30*700=21000)
                       ; #define TIMER1    5000
                       ; #define TIMER2    600
                       ; #define TIMER3    1000
                       ; #define TIMER4    1200
                       ; 
                       ; ////////////////////////////////////////////////////////////////////////////////
                       ; 
                       ; #define STACK_SIZE 0x100
                       ; 
                       ; /*static*/ BYTE task_one_stack[STACK_SIZE];
                       ; /*static*/ BYTE task_two_stack[STACK_SIZE];
                       ; /*static*/ BYTE task_three_stack[STACK_SIZE];
                       ; /*static*/ BYTE task_four_stack[STACK_SIZE];
                       ; 
                       ; PRESTO_TID_T one_tid=0;
                       ; PRESTO_TID_T two_tid=0;
                       ; PRESTO_TID_T three_tid=0;
                       ; PRESTO_TID_T four_tid=0;
                       ; 
                       ; BYTE light1=0x00;
                       ; BYTE light2=0x00;
                       ; BYTE light3=0x00;
                       ; BYTE light4=0x00;
                       ; 
                       ; ////////////////////////////////////////////////////////////////////////////////
                       ; 
                       ; #define MOTOR_PORT *(unsigned char *)(0x7FFF)
                       ; 
                       ; void assert_lights(void) {
                       ;    BYTE lights;
                       ;    lights=0xF0|light1|light2|light3|light4;
 0004 F60004            ldab _light1
 0007 4F                clra
 0008 8A00              oraa #0
 000A CAF0              orab #240
 000C 37                pshb ; 
 000D 36                psha ; spill
 000E F60005            ldab _light2
 0011 4F                clra
 0012 ED02              std 2,x
 0014 32                pula ; 
 0015 33                pulb ; reload
 0016 AA02              oraa 2,x
 0018 EA03              orab 3,x
 001A 37                pshb ; 
 001B 36                psha ; spill
 001C F60006            ldab _light3
 001F 4F                clra
 0020 ED02              std 2,x
 0022 32                pula ; 
 0023 33                pulb ; reload
 0024 AA02              oraa 2,x
 0026 EA03              orab 3,x
 0028 37                pshb ; 
 0029 36                psha ; spill
 002A F60007            ldab _light4
 002D 4F                clra
 002E ED02              std 2,x
 0030 32                pula ; 
 0031 33                pulb ; reload
 0032 AA02              oraa 2,x
 0034 EA03              orab 3,x
 0036 E705              stab 5,x
 0038                 test.41::	
                       ;    MOTOR_PORT=lights;
 0038 E605              ldab 5,x
 003A F77FFF            stab 0x7fff
 003D                 test.42::	
                       ; }
 003D                 L10:
 003D 8F                xgdx
 003E C30006            addd #6
 0041 8F                xgdx
 0042 35                txs
 0043 38                pulx
 0044 39                rts
                       ;  lreg1 -> -4,x
                       ;  lreg2 -> -8,x
                       ;  IX -> 0,x
                       ;          ?temp -> 2,x
                       ;            msg -> 6,x
 0045                 _One::
 0045 BD0000            jsr __enterb
 0048 8A                .byte 0x8a
 0049                 test.48::	
                       ; 
                       ; ////////////////////////////////////////////////////////////////////////////////
                       ; 
                       ; void One(void) {
                       ;    PRESTO_MAIL_T msg;
                       ;    msg.dw.dw1=0;
 0049 18CE025F          ldy #L12
 004D BD0000            jsr __ly2reg
 0050 EC00              ldd 0,x
 0052 C30006            addd #6
 0055 188F              xgdy
 0057 BD0000            jsr __lreg2y
 005A 2046              bra L14
 005C                 L13:
 005C                 test.50::	
                       ;    while(1) {
                       ;       light1=light1^0x01;
 005C F60004            ldab _light1
 005F 4F                clra
 0060 8800              eora #0
 0062 C801              eorb #1
 0064 F70004            stab _light1
 0067                 test.51::	
                       ;       assert_lights();
 0067 BD0000            jsr _assert_lights
 006A                 test.52::	
                       ;       presto_timer(one_tid,TIMER1,msg);
 006A EC00              ldd 0,x
 006C C30006            addd #6
 006F 188F              xgdy
 0071 EC00              ldd 0,x
 0073 C30002            addd #2
 0076 3C                pshx
 0077 8F                xgdx
 0078 CC0004            ldd #4
 007B BD0000            jsr __asgnblk
 007E 38                pulx
 007F EC00              ldd 0,x
 0081 C30002            addd #2
 0084 37                pshb
 0085 36                psha
 0086 CC1388            ldd #5000
 0089 37                pshb
 008A 36                psha
 008B F60000            ldab _one_tid
 008E 4F                clra
 008F 5D                tstb
 0090 2A01              bpl X0
 0092 43                coma
 0093                 X0:
 0093 BD0000            jsr _presto_timer
 0096 1838              puly
 0098 1838              puly
 009A                 test.53::	
                       ;       presto_wait_for_message(&msg);
 009A EC00              ldd 0,x
 009C C30006            addd #6
 009F BD0000            jsr _presto_wait_for_message
 00A2                 test.54::	
                       ;    }
 00A2                 L14:
 00A2 20B8              bra L13
 00A4                 L11:
 00A4 8F                xgdx
 00A5 C3000A            addd #10
 00A8 8F                xgdx
 00A9 35                txs
 00AA 38                pulx
 00AB 39                rts
                       ;  lreg1 -> -4,x
                       ;  lreg2 -> -8,x
                       ;  IX -> 0,x
                       ;          ?temp -> 2,x
                       ;            msg -> 6,x
 00AC                 _Two::
 00AC BD0000            jsr __enterb
 00AF 8A                .byte 0x8a
 00B0                 test.61::	
                       ; }
                       ; 
                       ; ////////////////////////////////////////////////////////////////////////////////
                       ; 
                       ; void Two(void) {
                       ;    PRESTO_MAIL_T msg;
                       ;    msg.dw.dw1=0;
 00B0 18CE025F          ldy #L12
 00B4 BD0000            jsr __ly2reg
 00B7 EC00              ldd 0,x
 00B9 C30006            addd #6
 00BC 188F              xgdy
 00BE BD0000            jsr __lreg2y
 00C1 2046              bra L18
 00C3                 L17:
 00C3                 test.63::	
                       ;    while(1) {
                       ;       light2=light2^0x02;
 00C3 F60005            ldab _light2
 00C6 4F                clra
 00C7 8800              eora #0
 00C9 C802              eorb #2
 00CB F70005            stab _light2
 00CE                 test.64::	
                       ;       assert_lights();
 00CE BD0000            jsr _assert_lights
 00D1                 test.65::	
                       ;       presto_timer(two_tid,TIMER2,msg);
 00D1 EC00              ldd 0,x
 00D3 C30006            addd #6
 00D6 188F              xgdy
 00D8 EC00              ldd 0,x
 00DA C30002            addd #2
 00DD 3C                pshx
 00DE 8F                xgdx
 00DF CC0004            ldd #4
 00E2 BD0000            jsr __asgnblk
 00E5 38                pulx
 00E6 EC00              ldd 0,x
 00E8 C30002            addd #2
 00EB 37                pshb
 00EC 36                psha
 00ED CC0258            ldd #600
 00F0 37                pshb
 00F1 36                psha
 00F2 F60001            ldab _two_tid
 00F5 4F                clra
 00F6 5D                tstb
 00F7 2A01              bpl X1
 00F9 43                coma
 00FA                 X1:
 00FA BD0000            jsr _presto_timer
 00FD 1838              puly
 00FF 1838              puly
 0101                 test.66::	
                       ;       presto_wait_for_message(&msg);
 0101 EC00              ldd 0,x
 0103 C30006            addd #6
 0106 BD0000            jsr _presto_wait_for_message
 0109                 test.67::	
                       ;    }
 0109                 L18:
 0109 20B8              bra L17
 010B                 L16:
 010B 8F                xgdx
 010C C3000A            addd #10
 010F 8F                xgdx
 0110 35                txs
 0111 38                pulx
 0112 39                rts
                       ;  lreg1 -> -4,x
                       ;  lreg2 -> -8,x
                       ;  IX -> 0,x
                       ;          ?temp -> 2,x
                       ;            msg -> 6,x
 0113                 _Three::
 0113 BD0000            jsr __enterb
 0116 8A                .byte 0x8a
 0117                 test.74::	
                       ; }
                       ; 
                       ; ////////////////////////////////////////////////////////////////////////////////
                       ; 
                       ; void Three(void) {
                       ;    PRESTO_MAIL_T msg;
                       ;    msg.dw.dw1=0;
 0117 18CE025F          ldy #L12
 011B BD0000            jsr __ly2reg
 011E EC00              ldd 0,x
 0120 C30006            addd #6
 0123 188F              xgdy
 0125 BD0000            jsr __lreg2y
 0128 2046              bra L22
 012A                 L21:
 012A                 test.76::	
                       ;    while(1) {
                       ;       light3=light3^0x04;
 012A F60006            ldab _light3
 012D 4F                clra
 012E 8800              eora #0
 0130 C804              eorb #4
 0132 F70006            stab _light3
 0135                 test.77::	
                       ;       assert_lights();
 0135 BD0000            jsr _assert_lights
 0138                 test.78::	
                       ;       presto_timer(three_tid,TIMER3,msg);
 0138 EC00              ldd 0,x
 013A C30006            addd #6
 013D 188F              xgdy
 013F EC00              ldd 0,x
 0141 C30002            addd #2
 0144 3C                pshx
 0145 8F                xgdx
 0146 CC0004            ldd #4
 0149 BD0000            jsr __asgnblk
 014C 38                pulx
 014D EC00              ldd 0,x
 014F C30002            addd #2
 0152 37                pshb
 0153 36                psha
 0154 CC03E8            ldd #1000
 0157 37                pshb
 0158 36                psha
 0159 F60002            ldab _three_tid
 015C 4F                clra
 015D 5D                tstb
 015E 2A01              bpl X2
 0160 43                coma
 0161                 X2:
 0161 BD0000            jsr _presto_timer
 0164 1838              puly
 0166 1838              puly
 0168                 test.79::	
                       ;       presto_wait_for_message(&msg);
 0168 EC00              ldd 0,x
 016A C30006            addd #6
 016D BD0000            jsr _presto_wait_for_message
 0170                 test.80::	
                       ;    }
 0170                 L22:
 0170 20B8              bra L21
 0172                 L20:
 0172 8F                xgdx
 0173 C3000A            addd #10
 0176 8F                xgdx
 0177 35                txs
 0178 38                pulx
 0179 39                rts
                       ;  lreg1 -> -4,x
                       ;  lreg2 -> -8,x
                       ;  IX -> 0,x
                       ;          ?temp -> 2,x
                       ;            msg -> 6,x
 017A                 _Four::
 017A BD0000            jsr __enterb
 017D 8A                .byte 0x8a
 017E                 test.87::	
                       ; }
                       ; 
                       ; ////////////////////////////////////////////////////////////////////////////////
                       ; 
                       ; void Four(void) {
                       ;    PRESTO_MAIL_T msg;
                       ;    msg.dw.dw1=0;
 017E 18CE025F          ldy #L12
 0182 BD0000            jsr __ly2reg
 0185 EC00              ldd 0,x
 0187 C30006            addd #6
 018A 188F              xgdy
 018C BD0000            jsr __lreg2y
 018F 2046              bra L26
 0191                 L25:
 0191                 test.89::	
                       ;    while(1) {
                       ;       light4=light4^0x08;
 0191 F60007            ldab _light4
 0194 4F                clra
 0195 8800              eora #0
 0197 C808              eorb #8
 0199 F70007            stab _light4
 019C                 test.90::	
                       ;       assert_lights();
 019C BD0000            jsr _assert_lights
 019F                 test.91::	
                       ;       presto_timer(four_tid,TIMER4,msg);
 019F EC00              ldd 0,x
 01A1 C30006            addd #6
 01A4 188F              xgdy
 01A6 EC00              ldd 0,x
 01A8 C30002            addd #2
 01AB 3C                pshx
 01AC 8F                xgdx
 01AD CC0004            ldd #4
 01B0 BD0000            jsr __asgnblk
 01B3 38                pulx
 01B4 EC00              ldd 0,x
 01B6 C30002            addd #2
 01B9 37                pshb
 01BA 36                psha
 01BB CC04B0            ldd #1200
 01BE 37                pshb
 01BF 36                psha
 01C0 F60003            ldab _four_tid
 01C3 4F                clra
 01C4 5D                tstb
 01C5 2A01              bpl X3
 01C7 43                coma
 01C8                 X3:
 01C8 BD0000            jsr _presto_timer
 01CB 1838              puly
 01CD 1838              puly
 01CF                 test.92::	
                       ;       presto_wait_for_message(&msg);
 01CF EC00              ldd 0,x
 01D1 C30006            addd #6
 01D4 BD0000            jsr _presto_wait_for_message
 01D7                 test.93::	
                       ;    }
 01D7                 L26:
 01D7 20B8              bra L25
 01D9                 L24:
 01D9 8F                xgdx
 01DA C3000A            addd #10
 01DD 8F                xgdx
 01DE 35                txs
 01DF 38                pulx
 01E0 39                rts
                       ;  IX -> 0,x
 01E1                 _main::
 01E1                 test.100::	
                       ; }
                       ; 
                       ; ////////////////////////////////////////////////////////////////////////////////
                       ; 
                       ; int main(void) {
                       ; 
                       ;    presto_init();
 01E1 BD0000            jsr _presto_init
 01E4                 test.102::	
                       ; #if TIMER1 != 0
                       ;    one_tid=presto_create_task(One, task_one_stack, STACK_SIZE, 35);
 01E4 CC0023            ldd #35
 01E7 37                pshb
 01E8 36                psha
 01E9 CC0100            ldd #256
 01EC 37                pshb
 01ED 36                psha
 01EE CC0300            ldd #_task_one_stack
 01F1 37                pshb
 01F2 36                psha
 01F3 CC0045            ldd #_One
 01F6 BD0000            jsr _presto_create_task
 01F9 BD0000            jsr __movspb
 01FC 06                .byte 6
 01FD F70000            stab _one_tid
 0200                 test.105::	
                       ; #endif
                       ; #if TIMER2 != 0
                       ;    two_tid=presto_create_task(Two, task_two_stack, STACK_SIZE, 40);
 0200 CC0028            ldd #40
 0203 37                pshb
 0204 36                psha
 0205 CC0100            ldd #256
 0208 37                pshb
 0209 36                psha
 020A CC0200            ldd #_task_two_stack
 020D 37                pshb
 020E 36                psha
 020F CC00AC            ldd #_Two
 0212 BD0000            jsr _presto_create_task
 0215 BD0000            jsr __movspb
 0218 06                .byte 6
 0219 F70001            stab _two_tid
 021C                 test.108::	
                       ; #endif
                       ; #if TIMER3 != 0
                       ;    three_tid=presto_create_task(Three, task_three_stack, STACK_SIZE, 45);
 021C CC002D            ldd #45
 021F 37                pshb
 0220 36                psha
 0221 CC0100            ldd #256
 0224 37                pshb
 0225 36                psha
 0226 CC0100            ldd #_task_three_stack
 0229 37                pshb
 022A 36                psha
 022B CC0113            ldd #_Three
 022E BD0000            jsr _presto_create_task
 0231 BD0000            jsr __movspb
 0234 06                .byte 6
 0235 F70002            stab _three_tid
 0238                 test.111::	
                       ; #endif
                       ; #if TIMER4 != 0
                       ;    four_tid=presto_create_task(Four, task_four_stack, STACK_SIZE, 50);
 0238 CC0032            ldd #50
 023B 37                pshb
 023C 36                psha
 023D CC0100            ldd #256
 0240 37                pshb
 0241 36                psha
 0242 CC0000            ldd #_task_four_stack
 0245 37                pshb
 0246 36                psha
 0247 CC017A            ldd #_Four
 024A BD0000            jsr _presto_create_task
 024D BD0000            jsr __movspb
 0250 06                .byte 6
 0251 F70003            stab _four_tid
 0254                 test.118::	
                       ; #endif
                       ; 
                       ;    //motor_init();
                       ;    //lcd_init();
                       ;    //serial_init(9600);
                       ;    //debugger_init();
                       ;    presto_start_scheduler();
 0254 BD0000            jsr _presto_start_scheduler
 0257                 test.120::	
                       ;    // we never get here
                       ;    presto_fatal_error();
 0257 BD0000            jsr _presto_fatal_error
 025A                 test.121::	
                       ;    return 0;
 025A CC0000            ldd #0
 025D 39                rts
 025E                 L28:
 025E 39                rts
                         .area bss
 0000                 _task_four_stack::
 0000                   .blkb 256
 0100                 _task_three_stack::
 0100                   .blkb 256
 0200                 _task_two_stack::
 0200                   .blkb 256
 0300                 _task_one_stack::
 0300                   .blkb 256
                         .area text
 025F                 L12:
 025F 00000000          .word 0,0
