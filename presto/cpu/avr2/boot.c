////////////////////////////////////////////////////////////////////////////////
//   C O M M E N T A R Y
////////////////////////////////////////////////////////////////////////////////

// This is the first code that runs.


////////////////////////////////////////////////////////////////////////////////
//   D E P E N D E N C I E S
////////////////////////////////////////////////////////////////////////////////

#include "configure.h"
#include "cpu_locks.h"
#include "boot.h"
#include "registers.h"
#include <avr/io.h>


////////////////////////////////////////////////////////////////////////////////
//   C O N S T A N T S
////////////////////////////////////////////////////////////////////////////////



////////////////////////////////////////////////////////////////////////////////
//   G L O B A L   D A T A
////////////////////////////////////////////////////////////////////////////////



////////////////////////////////////////////////////////////////////////////////
//   E X P O R T E D   F U N C T I O N S
////////////////////////////////////////////////////////////////////////////////

// This function is called from the startup (crt11.s) before interrupts have
// been turned on but after the stack has been set up.

void reset_vector() __attribute__((naked));
void reset_vector() {
   cpu_lock();
   outb(SPCR,0x00);   // disable SPI
   outb(UCR,0x00);    // disable UART
   outb(WDTCR,0x00);  // disable watchdog
   outb(DDRB,0xFF);   // LEDs are outputs
   outb(PORTB,0xFF);  // turn off all LEDs
   outb(DDRD,0x00);   // PINs are inputs
   asm volatile("rjmp __init");
}

////////////////////////////////////////////////////////////////////////////////

