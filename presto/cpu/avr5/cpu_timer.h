
#ifndef _CPU_TIMER_H_
#define _CPU_TIMER_H_

////////////////////////////////////////////////////////////////////////////////

#include <avr/io.h>
#include "cpu_magic.h"
#include "registers.h"

////////////////////////////////////////////////////////////////////////////////

// system timer
extern void hwtimer_start(unsigned short ms, void (*func)(void));
extern void hwtimer_restart(void);

////////////////////////////////////////////////////////////////////////////////
//   T I M E R   I S R   S T U F F
////////////////////////////////////////////////////////////////////////////////

#define CPU_TIMER_DECLARE_ISR(x)   void x (void) __attribute__((naked));
#define CPU_TIMER_START_OF_ISR()   CPU_PUSH_ALL_REGISTERS();
#define CPU_TIMER_END_OF_ISR()     CPU_POP_ALL_REGISTERS();

////////////////////////////////////////////////////////////////////////////////
//   T I M E R   F U N C T I O N S
////////////////////////////////////////////////////////////////////////////////

#define CPU_TIMER_START(ms,func)   hwtimer_start(ms,func);
#define CPU_TIMER_RESTART()        hwtimer_restart();

////////////////////////////////////////////////////////////////////////////////

#endif // _CPU_TIMER_H_

